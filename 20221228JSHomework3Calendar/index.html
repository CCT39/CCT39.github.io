<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link rel="stylesheet" href="./reset.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <!-- Until: 2022.12.31 02:58 ~7hrs -->
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 w-100 px-0">
                <table class="table table-info table-bordered border-primary w-100">
                    <caption align="top">
                        <div id="prev"><i class="fa-sharp fa-solid fa-caret-left"></i></div>
                            <h1 class="col-12 text-center my-2 py-2 position-relative">
                                羅馬人的日曆
                                <!-- <sup><i class="fa-solid fa-circle-info position-absolute"></i></sup> -->
                                <br><span class="spqr">Calendarium Populumque Romanum</span>
                            </h1>
                            <p class="text-center"><span class="fs-1" id="year"></span>
                                <span class="fs-3" id="month"></span></p>
                        <div id="post"><i class="fa-sharp fa-solid fa-caret-right"></i></div>
                    </caption>
                    <thead>
                        <tr class="w-100 fs-5 text-center">
                            <th> <strong>Sun</strong><br><span class="spqr">dies Solis</span></th>
                            <th> <strong>Mon</strong><br><span class="spqr">dies Lunae</span></th>
                            <th> <strong>Tue</strong><br><span class="spqr">dies Martis</span></th>
                            <th> <strong>Wed</strong><br><span class="spqr">dies Mercurii</span></th>
                            <th> <strong>Thu</strong><br><span class="spqr">dies Iovis</span></th>
                            <th> <strong>Fri</strong><br><span class="spqr">dies Veneris</span></th>
                            <th> <strong>Sat</strong><br><span class="spqr">dies Saturni</span></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="w-100">
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="w-100">
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="w-100">
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="w-100">
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="w-100">
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="w-100">
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="modal fade" id="inputSchedules" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                    <button type="button" class="btn btn-primary">儲存變更</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <script>
        const currentFullDate = new Date();
        const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
        const daysOfMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
        // date = new Date();
        // date 取得完整時間 e.g. Sat Dec 31 2022 15:47:03 GMT+0800 (台北標準時間)
        // date.getDay() 取得星期（0-6，週日 = 0）
        // date.getFullYear() 取得4位數字西元年
        // date.getMonth() 取得月份（0-11）
        // date.getDate() 取得日（1-31）
        let currentYear, currentMonth, currentDate, currentWeekday;
        let tbody, allTds, displayYear, displayMonth, btnPrev, btnPost;
        let trArr = [], currDayOfMonthArr = [];
        
        window.onload = () => {
            getElement();
            initVariables();
            setEventListeners();
            initTable();
        }
        function getElement(){
            tbody = document.querySelector('tbody');
            allTds = document.querySelectorAll('td');
            displayYear = document.getElementById('year');
            displayMonth = document.getElementById('month');
            btnPrev = document.getElementById('prev');
            btnPost = document.getElementById('post');
        }
        function initVariables(){
            currentYear = currentFullDate.getFullYear();
            currentMonth = currentFullDate.getMonth();
            currentDate = currentFullDate.getDate();
            currentWeekday = currentFullDate.getDay();
        }
        function setEventListeners(){
            btnPrev.addEventListener('click', () => { moveMonth(false); })
            btnPost.addEventListener('click', () => { moveMonth(true); })
        }
        function initTable(){
            document.querySelectorAll('.spqr').forEach(x => { x.innerHTML = x.innerHTML.replaceAll('u', 'v').replaceAll('ae', 'ӕ').replaceAll('j', 'i').replaceAll('w', 'v'); })
            checkLeapYear();
            setThisMonth();
        }

        function moveMonth(isForward){
            let step = 1;
            if (isForward == false){ step = -1; }

            currentMonth += step;
            checkMonthOverflow();
            setThisMonth();
        }

        function checkMonthOverflow(){
            if (currentMonth >= 0 && currentMonth <= 11){ return; }

            if (currentMonth < 0){ 
                currentMonth += 12; 
                currentYear -= 1;
            } else if (currentMonth > 11){
                currentMonth -= 12; 
                currentYear += 1;
            }
            checkLeapYear();
        }

        function checkLeapYear(){
            currDayOfMonthArr = daysOfMonth;

            let beginningDate = new Date(currentYear, 01, 01);
            let endingDate = new Date(currentYear, 12, 31);
            if (beginningDate.getDay() != endingDate.getDay()){ currDayOfMonthArr[1] = 29; } 
            else { currDayOfMonthArr[1] = 28; }
        }

        function setThisMonth(){
            const clearThisMonth = () => {
                allTds.forEach(x => { 
                    x.removeAttribute('data-date');
                    x.removeAttribute('data-bs-toggle');
                    x.removeAttribute('data-bs-target');
                    x.classList.remove('disabled-cell'); 
                    x.innerHTML = '';
                })
            }
            const showTextsOnCells = () => {
                let firstDay = new Date(currentYear, currentMonth, 01);
                for(let i = 0; i < currDayOfMonthArr[currentMonth]; i++){
                    let index = firstDay.getDay() + i;
                    let targetCell = allTds[index];
                    let tempDate = (i + 1).toString().padStart(2, '0');
                    let monthIn2Digits = currentMonth.toString().padStart(2, '0');

                    targetCell.innerHTML = `<p class="text-center fw-bold">${tempDate}</p>`;
                    targetCell.setAttribute('data-date', `${currentYear}${monthIn2Digits}${tempDate}`);
                }
            }
            const setAttributesOfCells = () => {
                allTds.forEach(x => {
                    if (x.dataset.date == null){ x.classList.add('disabled-cell'); }
                    else{
                        x.setAttribute("data-bs-toggle", "modal");
                        x.setAttribute("data-bs-target", "#inputSchedules");
                    }
                });
            }
            const displayYearAndMonthOnTitle = () => {
                displayYear.innerHTML = currentYear;
                displayMonth.innerHTML = months[currentMonth];
            }

            clearThisMonth();
            showTextsOnCells();
            setAttributesOfCells();
            displayYearAndMonthOnTitle();
        }
    </script>
</body>
</html>